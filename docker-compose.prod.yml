version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tgsendauction-prod
    restart: unless-stopped
    ports:
      - '80:80'      # Frontend (nginx)
      - '3000:3000'  # Backend API
      - '27017:27017' # MongoDB
    environment:
      NODE_ENV: production
      PORT: 3000
      MONGODB_URI: mongodb://localhost:27017/auction_db
      TELEGRAM_BOT_TOKEN: 8090299133:AAHL83f8hxEPwtc_iv8CH9cGQqmcHmRtHfk
      ALLOWED_ORIGINS: https://web.telegram.org,https://t.me
    volumes:
      - mongodb_data:/data/db
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  mongodb_data:
